<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NeonConnect Ultra | Colorful P2P</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/simple-peer@9.11.1/simplepeer.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;900&family=Rajdhani:wght@600;700&display=swap');
        
        body { 
            background: #020205; 
            color: #fff; 
            font-family: 'Rajdhani', sans-serif;
            height: 100vh;
            overflow: hidden;
            background: linear-gradient(45deg, #050505, #111122, #050505);
        }

        /* Rainbow Neon Glows */
        .neon-card {
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #00ffff;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.3), inset 0 0 10px rgba(0, 255, 255, 0.2);
            border-radius: 25px;
        }

        .neon-text-blue { text-shadow: 0 0 10px #00ffff, 0 0 20px #00ffff; color: #00ffff; }
        .neon-text-pink { text-shadow: 0 0 10px #ff00ff, 0 0 20px #ff00ff; color: #ff00ff; }

        .btn-gradient {
            background: linear-gradient(90deg, #00ffff, #ff00ff, #ffff00);
            background-size: 200% auto;
            color: #000;
            font-weight: 900;
            transition: 0.5s;
        }
        .btn-gradient:hover { background-position: right center; transform: scale(1.05); box-shadow: 0 0 25px #ff00ff; }

        .video-box {
            border: 3px solid #ff00ff;
            box-shadow: 0 0 25px rgba(255, 0, 255, 0.5);
            border-radius: 20px;
            background: #000;
        }

        /* Message Bubbles - Extra Colorful */
        .bubble-me {
            background: linear-gradient(135deg, #00dbde 0%, #fc00ff 100%);
            color: white;
            border-radius: 20px 20px 5px 20px;
            box-shadow: 0 5px 15px rgba(252, 0, 255, 0.3);
        }
        .bubble-them {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 20px 20px 20px 5px;
            box-shadow: 0 5px 15px rgba(118, 75, 162, 0.3);
        }

        /* Animated Pulse */
        @keyframes pulse-cyan {
            0% { box-shadow: 0 0 0 0 rgba(0, 255, 255, 0.7); }
            70% { box-shadow: 0 0 0 15px rgba(0, 255, 255, 0); }
            100% { box-shadow: 0 0 0 0 rgba(0, 255, 255, 0); }
        }
        .active-ring { animation: pulse-cyan 2s infinite; }
    </style>
</head>
<body class="flex items-center justify-center p-4">

    <div class="neon-card w-full max-w-6xl h-[90vh] flex flex-col lg:flex-row overflow-hidden border-2 border-cyan-500">
        
        <div class="lg:w-1/3 w-full bg-gradient-to-b from-black to-purple-900/20 p-6 flex flex-col gap-5 border-r border-cyan-900">
            <div class="text-center py-4">
                <h1 style="font-family: 'Orbitron';" class="text-4xl font-black neon-text-blue">NEON<span class="neon-text-pink">PRO</span></h1>
                <p class="text-[10px] tracking-[0.4em] text-white opacity-50 mt-1 uppercase">Cyber Communication</p>
            </div>

            <div class="space-y-4">
                <div class="group">
                    <label class="text-xs font-bold text-cyan-400 ml-1">MY DIGITAL ID</label>
                    <div class="flex gap-2">
                        <input id="myId" type="text" placeholder="Your ID..." class="w-full bg-black/50 border border-cyan-500 p-3 rounded-xl outline-none focus:ring-2 ring-cyan-500 text-white font-bold">
                        <button onclick="copyInviteLink()" class="bg-cyan-500 text-black px-4 rounded-xl hover:bg-white transition-all">
                            <i class="fas fa-share-alt"></i>
                        </button>
                    </div>
                </div>

                <div>
                    <label class="text-xs font-bold text-pink-400 ml-1">TARGET FREQUENCY</label>
                    <input id="friendId" type="text" placeholder="Friend's ID..." class="w-full bg-black/50 border border-pink-500 p-3 rounded-xl outline-none focus:ring-2 ring-pink-500 text-white font-bold">
                </div>

                <div class="flex gap-2">
                    <button onclick="makeCall(true)" class="btn-gradient flex-1 py-4 rounded-2xl text-lg flex items-center justify-center gap-2">
                        <i class="fas fa-bolt"></i> CONNECT
                    </button>
                    <button onclick="endCall()" class="bg-red-600 hover:bg-red-400 px-6 rounded-2xl font-bold transition-all">
                        <i class="fas fa-power-off"></i>
                    </button>
                </div>
            </div>

            <div class="flex-1 flex flex-col bg-black/60 rounded-3xl border border-white/10 overflow-hidden mt-2">
                <div id="chatBox" class="flex-1 p-4 overflow-y-auto flex flex-col gap-3">
                    <p class="text-[10px] text-center text-cyan-500/50 uppercase tracking-widest">Encrypted Data Stream</p>
                </div>
                <div class="p-3 bg-white/5 flex gap-2">
                    <input id="msgInput" type="text" placeholder="Type a message..." class="bg-transparent flex-1 outline-none text-sm text-white">
                    <button onclick="sendChatMessage()" class="text-cyan-400 hover:text-white transition-all"><i class="fas fa-paper-plane"></i></button>
                </div>
            </div>
        </div>

        <div class="flex-1 bg-black p-6 relative flex flex-col gap-4">
            <div class="flex-1 relative video-box overflow-hidden active-ring">
                <video id="remoteVideo" autoplay class="w-full h-full object-cover"></video>
                
                <div id="placeholder" class="absolute inset-0 flex flex-col items-center justify-center bg-black/90">
                    <i class="fas fa-atom text-6xl text-cyan-500 animate-spin-slow mb-6" style="animation: spin 8s linear infinite;"></i>
                    <p class="neon-text-blue font-bold tracking-[0.5em] text-sm">AWAITING CONNECTION</p>
                </div>

                <div class="absolute bottom-6 right-6 w-36 h-48 border-2 border-cyan-400 rounded-2xl overflow-hidden shadow-2xl z-20 bg-black">
                    <video id="localVideo" autoplay muted class="w-full h-full object-cover"></video>
                    <div class="absolute top-0 left-0 w-full bg-cyan-500/80 text-black text-[8px] font-black text-center py-1">MY_STREAM</div>
                </div>
            </div>

            <div class="h-12 bg-gradient-to-r from-cyan-900/20 via-pink-900/20 to-cyan-900/20 rounded-2xl border border-white/5 flex items-center px-6 justify-between">
                <div class="flex gap-1">
                    <div class="w-1 h-4 bg-cyan-500 animate-bounce"></div>
                    <div class="w-1 h-6 bg-pink-500 animate-bounce" style="animation-delay: 0.2s"></div>
                    <div class="w-1 h-3 bg-yellow-500 animate-bounce" style="animation-delay: 0.4s"></div>
                </div>
                <span class="text-[10px] font-black tracking-widest text-cyan-500">SECURE P2P SIGNAL : ACTIVE</span>
                <div class="flex gap-1">
                    <div class="w-1 h-3 bg-yellow-500 animate-bounce" style="animation-delay: 0.4s"></div>
                    <div class="w-1 h-6 bg-pink-500 animate-bounce" style="animation-delay: 0.2s"></div>
                    <div class="w-1 h-4 bg-cyan-500 animate-bounce"></div>
                </div>
            </div>
        </div>
    </div>

<script>
/* Firebase Setup */
const firebaseConfig = {
    apiKey: "AIzaSyDLxciFvteNdb1-gLgwH96WvppubzjDABw",
    authDomain: "neon-chat-app-db73c.firebaseapp.com",
    projectId: "neon-chat-app-db73c",
    databaseURL: "https://neon-chat-app-db73c-default-rtdb.firebaseio.com",
    appId: "1:1017316698976:web:6250fa0dd5597deccbcc05"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let localStream, peer, myId = '';

window.onload = () => {
    const params = new URLSearchParams(window.location.search);
    if(params.get('call')) document.getElementById('friendId').value = params.get('call');
};

function copyInviteLink() {
    myId = document.getElementById('myId').value;
    if(!myId) return alert("Enter your ID first!");
    const link = `${window.location.origin}${window.location.pathname}?call=${myId}`;
    navigator.clipboard.writeText(link);
    alert("ðŸš€ Invite Signal Copied!");
}

async function makeCall(isVideo) {
    myId = document.getElementById('myId').value;
    const friendId = document.getElementById('friendId').value;
    if(!myId || !friendId) return;

    try {
        localStream = await navigator.mediaDevices.getUserMedia({ audio: true, video: isVideo });
        document.getElementById('localVideo').srcObject = localStream;
        document.getElementById('placeholder').style.display = 'none';

        peer = new SimplePeer({ initiator: true, trickle: false, stream: localStream });

        peer.on('signal', data => {
            db.ref('calls/' + friendId).set({ from: myId, signal: JSON.stringify(data) });
        });

        setupPeerEvents();

        db.ref('answers/' + myId).on('value', snapshot => {
            const data = snapshot.val();
            if(data && peer) peer.signal(JSON.parse(data.signal));
        });
    } catch(err) { alert("Enable camera/mic!"); }
}

function setupPeerEvents() {
    peer.on('stream', stream => {
        document.getElementById('remoteVideo').srcObject = stream;
    });

    peer.on('data', data => {
        appendMessage('Other', data.toString());
    });
}

function sendChatMessage() {
    const input = document.getElementById('msgInput');
    if(!input.value || !peer) return;
    peer.send(input.value);
    appendMessage('You', input.value);
    input.value = '';
}

function appendMessage(sender, text) {
    const chatBox = document.getElementById('chatBox');
    const msgDiv = document.createElement('div');
    msgDiv.className = `p-3 max-w-[85%] text-xs font-bold ${sender === 'You' ? 'bubble-me self-end' : 'bubble-them self-start'}`;
    msgDiv.innerHTML = `<p>${text}</p>`;
    chatBox.appendChild(msgDiv);
    chatBox.scrollTop = chatBox.scrollHeight;
}

setInterval(() => {
    myId = document.getElementById('myId').value;
    if(!myId) return;

    db.ref('calls/' + myId).once('value', async snapshot => {
        const data = snapshot.val();
        if(data && !peer) {
            if(confirm("New Signal Request from: " + data.from)) {
                localStream = await navigator.mediaDevices.getUserMedia({ audio: true, video: true });
                document.getElementById('localVideo').srcObject = localStream;
                document.getElementById('placeholder').style.display = 'none';

                peer = new SimplePeer({ initiator: false, trickle: false, stream: localStream });

                peer.on('signal', signalData => {
                    db.ref('answers/' + data.from).set({ signal: JSON.stringify(signalData) });
                    db.ref('calls/' + myId).remove();
                });

                setupPeerEvents();
                peer.signal(JSON.parse(data.signal));
            } else { db.ref('calls/' + myId).remove(); }
        }
    });
}, 3000);

function endCall() { location.reload(); }
</script>
</body>
</html>
