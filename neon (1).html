 <!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Neon Private Chat 1-to-1</title>

<!-- Tailwind -->
<script src="https://cdn.tailwindcss.com"></script>

<!-- Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<!-- Firebase v8 (Stable) -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<!-- WebRTC -->
<script src="https://cdn.jsdelivr.net/npm/simple-peer@9.11.1/simplepeer.min.js"></script>

<style>
body{
  background: linear-gradient(135deg,#0f0c29,#302b63,#24243e);
  color:white;
  font-family:sans-serif;
}
#chatBox{
  height:400px;
  overflow-y:auto;
  padding:10px;
  margin-bottom:10px;
}
.message{
  padding:8px 12px;
  border-radius:15px;
  margin:6px;
  display:inline-block;
  max-width:75%;
}
.self{background:#00ffff;color:#000;float:right;clear:both;}
.other{background:#ff00ff;color:#fff;float:left;clear:both;}
.glass{
  background:rgba(255,255,255,0.1);
  backdrop-filter:blur(10px);
  border-radius:15px;
  padding:10px;
}
</style>
</head>

<body class="flex flex-col items-center p-4 min-h-screen">

<h1 class="text-3xl font-bold mb-3 text-center">üîê Neon 1-to-1 Private Chat + Call</h1>

<div class="w-full max-w-md">
  <input id="username" placeholder="Your Name" class="w-full p-2 mb-2 rounded text-black">
  <input id="myMobile" placeholder="Your Mobile Number" class="w-full p-2 mb-2 rounded text-black">
  <input id="targetMobile" placeholder="Receiver Mobile Number" class="w-full p-2 mb-2 rounded text-black">

  <button onclick="startPrivateChat()" 
  class="bg-purple-600 w-full py-2 rounded mb-2 hover:bg-purple-500">
  üîê Start Private Chat
  </button>

  <div id="status" class="text-center text-sm mb-2 text-cyan-300"></div>

  <div id="chatBox" class="glass"></div>

  <div class="flex">
    <input id="messageInput" placeholder="Type message..." class="flex-1 p-2 rounded-l text-black">
    <button onclick="sendMessage()" class="bg-cyan-500 px-4 rounded-r hover:bg-cyan-400">Send</button>
  </div>

  <div class="flex justify-between mt-4">
    <button onclick="startAudioCall()" class="bg-green-500 px-3 py-2 rounded hover:bg-green-400">
      <i class="fa-solid fa-phone"></i> Call
    </button>
    <button onclick="startVideoCall()" class="bg-blue-500 px-3 py-2 rounded hover:bg-blue-400">
      <i class="fa-solid fa-video"></i> Video
    </button>
    <button onclick="endCall()" class="bg-red-500 px-3 py-2 rounded hover:bg-red-400">
      <i class="fa-solid fa-phone-slash"></i> End
    </button>
  </div>
</div>

<video id="localVideo" autoplay muted class="mt-3 w-64 rounded"></video>
<video id="remoteVideo" autoplay class="mt-3 w-64 rounded"></video>

<script>
// ===== YOUR FIREBASE CONFIG =====
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "neon-chat-app-db73c.firebaseapp.com",
  databaseURL: "https://neon-chat-app-db73c-default-rtdb.firebaseio.com/",
  projectId: "neon-chat-app-db73c"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let chatRoom = "";
let currentUser = "";
let myMobile = "";
let peer = null;
let localStream = null;

const chatBox = document.getElementById("chatBox");
const statusDiv = document.getElementById("status");

// Generate Unique Room (Mobile Based)
function generateRoom(m1, m2){
  return [m1, m2].sort().join("_");
}

// Start Private Chat
function startPrivateChat(){
  currentUser = document.getElementById("username").value.trim();
  myMobile = document.getElementById("myMobile").value.trim();
  const targetMobile = document.getElementById("targetMobile").value.trim();

  if(!currentUser || !myMobile || !targetMobile){
    alert("Enter Name, Your Mobile & Receiver Mobile");
    return;
  }

  chatRoom = generateRoom(myMobile, targetMobile);
  chatBox.innerHTML = "";
  statusDiv.innerText = "Connected to Private Room: " + chatRoom;

  db.ref("private_chats/" + chatRoom + "/messages")
    .off()
    .on("child_added", snap => {
      const data = snap.val();
      renderMessage(data);
    });
}

// Send Message (Private)
function sendMessage(){
  const msg = document.getElementById("messageInput").value.trim();
  if(!chatRoom){
    alert("Start Private Chat First!");
    return;
  }
  if(!msg) return;

  db.ref("private_chats/" + chatRoom + "/messages").push({
    user: currentUser,
    mobile: myMobile,
    msg: msg,
    time: new Date().toLocaleTimeString()
  });

  document.getElementById("messageInput").value = "";
}

// Render Messages
function renderMessage(data){
  const div = document.createElement("div");
  div.className = "message " + (data.mobile === myMobile ? "self" : "other");
  div.innerHTML = `
    <strong>${data.user}</strong><br>
    ${data.msg}<br>
    <small>${data.time}</small>
  `;
  chatBox.appendChild(div);
  chatBox.scrollTop = chatBox.scrollHeight;
}

// ===== CALL SYSTEM (ROOM BASED) =====
async function startAudioCall(){
  if(!chatRoom) return alert("Start private chat first");
  localStream = await navigator.mediaDevices.getUserMedia({audio:true});
  initPeer();
}

async function startVideoCall(){
  if(!chatRoom) return alert("Start private chat first");
  localStream = await navigator.mediaDevices.getUserMedia({audio:true, video:true});
  document.getElementById("localVideo").srcObject = localStream;
  initPeer();
}

function initPeer(){
  peer = new SimplePeer({
    initiator:true,
    trickle:false,
    stream:localStream
  });

  peer.on("signal", data=>{
    db.ref("private_calls/" + chatRoom + "/signal").set(JSON.stringify(data));
  });

  db.ref("private_calls/" + chatRoom + "/signal").on("value", snap=>{
    if(snap.val()){
      try{
        peer.signal(JSON.parse(snap.val()));
      }catch(e){}
    }
  });

  peer.on("stream", stream=>{
    document.getElementById("remoteVideo").srcObject = stream;
  });
}

// End Call
function endCall(){
  if(peer) peer.destroy();
  if(localStream){
    localStream.getTracks().forEach(t=>t.stop());
  }
  document.getElementById("localVideo").srcObject = null;
  document.getElementById("remoteVideo").srcObject = null;
  if(chatRoom){
    db.ref("private_calls/" + chatRoom).remove();
  }
  alert("Call Ended");
}
</script>

</body>
</html>